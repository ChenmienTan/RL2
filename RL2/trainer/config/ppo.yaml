defaults:
- _self_
- actor: fsdp
- ref_actor: ${actor}
- critic: ${actor}

actor:
  max_inference_length_per_device: ${actor.max_length_per_device}
  temperature: ${rollout.train.sampling_params.temperature}
  update_per_rollout: 1
  clip: 0.2
  tis_coef: 0.0
  avg_level: token
  freeze_steps: 0
  offload_model: true
  adv_estimator: ${adv.estimator}

  kl:
    coef: 0.0
    type: null # `reward` or `loss`
    reward_estimator: k1
    loss_estimator: k2
    # `k1`, `k2` or `k3`. See http://joschu.net/blog/kl-approx.html.

  entropy:
    coef: 0.0

rollout:
  server_args:
    model_path: ${actor.model_name}
    dtype: ${actor.dtype}
    tp_size: 1
    mem_fraction_static: 0.6
  train:
    path: null
    prompt_key: prompt
    messages_key: messages
    apply_chat_template: true
    prompts_per_rollout: null
    responses_per_prompt: 1
    sampling_params:
      temperature: 1.0
      max_new_tokens: null
      stop: null
    dynamic_filtering: true
    partial_rollout: false
    enable_privileged_critic: false
    save_dir: ${trainer.save_dir}/train
  test:
    path: null
    prompt_key: ${rollout.train.prompt_key}
    messages_key: ${rollout.train.messages_key}
    apply_chat_template: ${rollout.train.apply_chat_template}
    prompts_per_rollout: null
    responses_per_prompt: 1
    sampling_params:
      temperature: 0.0
      max_new_tokens: ${rollout.train.sampling_params.max_new_tokens}
      stop: ${rollout.train.sampling_params.stop}
    save_dir: ${trainer.save_dir}/test
  env_path: null
  bucket_size: 512

ref_actor:
  temperature: ${rollout.train.sampling_params.temperature}

critic:
  max_inference_length_per_device: ${critic.max_length_per_device}
  update_per_rollout: ${actor.update_per_rollout}
  clip: 0.5
  avg_level: ${actor.avg_level}
  offload_model: ${actor.offload_model}

adv:
  estimator: reinforce # `reinforce` or `gae`
  gamma: 1.0
  lamda: 1.0
  responses_per_prompt: ${rollout.train.responses_per_prompt}
  global_norm: false
  norm_var: false
  
trainer:
  project: null
  experiment_name: null
  load_ckpt_from: null
  total_steps: null
  eval_only: false
  test_freq: null
  save_dir: ckpts/${trainer.experiment_name}
  save_freq: null
  use_wandb: true